<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Realtime Voice Translator ‚Äì Mobile Friendly</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:#0b1020; color:#e6e8ef; margin:0; padding:16px; }
    header { margin-bottom:16px; }
    h1 { font-size:20px; }
    select, button { padding:8px 12px; margin-right:8px; border-radius:8px; border:none; }
    button { background:#4f5dff; color:#fff; }
    button.secondary { background:#2a316d; }
    .stream { margin-top:8px; font-family: monospace; line-height:1.6; word-wrap:break-word; }
    .card { background:#12183a; border-radius:12px; padding:12px; margin-bottom:16px; }
    footer { margin-top:16px; font-size:12px; color:#9aa0ff; }
  </style>
</head>
<body>
  <header>
    <h1>üéôÔ∏è Realtime Cascading Voice Translator</h1>
  </header>

  <div class="card">
    <h2>Live Speech ‚Üí Words</h2>
    <select id="srcLang">
      <option value="en-US">English</option>
      <option value="hi-IN">Hindi</option>
      <option value="fr-FR">French</option>
      <option value="es-ES">Spanish</option>
    </select>
    <button id="startBtn">Start</button>
    <button id="stopBtn" class="secondary">Stop</button>
    <div id="liveWords" class="stream"></div>
  </div>

  <div class="card">
    <h2>Realtime Word-by-Word Translation</h2>
    <select id="tgtLang">
      <option value="es">Spanish</option>
      <option value="fr">French</option>
      <option value="hi">Hindi</option>
    </select>
    <div id="translatedWords" class="stream"></div>
  </div>

  <footer>
    ‚úîÔ∏è Works on mobile & desktop Chrome ¬∑ Uses Web Speech API ¬∑ LibreTranslate API (free)
  </footer>

<script>
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
  alert('SpeechRecognition API not supported. Use Chrome mobile or desktop.');
}

const recognition = new SpeechRecognition();
recognition.continuous = true;
recognition.interimResults = true;

const liveWords = document.getElementById('liveWords');
const translatedWords = document.getElementById('translatedWords');
let processedText = '';

recognition.onresult = async (event) => {
  let fullTranscript = '';
  for (let i = 0; i < event.results.length; i++) {
    fullTranscript += event.results[i][0].transcript;
  }

  // Show live speech
  liveWords.textContent = fullTranscript;

  const delta = fullTranscript.slice(processedText.length).trim();
  processedText = fullTranscript;

  if (!delta) return;

  const words = delta.split(/\s+/);
  for (const word of words) {
    try {
      const t = await translateWord(word);
      translatedWords.textContent += t + ' ';
    } catch(e) {
      translatedWords.textContent += '[' + word + '] ';
    }
  }
};

recognition.onerror = (e) => {
  console.error('SpeechRecognition error:', e.error);
};

async function translateWord(word) {
  const target = document.getElementById('tgtLang').value;
  const res = await fetch('https://libretranslate.de/translate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ q: word, source: 'auto', target })
  });
  const data = await res.json();
  return data.translatedText || word;
}

document.getElementById('startBtn').onclick = () => {
  recognition.lang = document.getElementById('srcLang').value;
  processedText = '';
  liveWords.textContent = '';
  translatedWords.textContent = '';
  recognition.start();
};

document.getElementById('stopBtn').onclick = () => recognition.stop();
</script>
</body>
</html>
